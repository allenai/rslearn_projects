model:
  class_path: rslearn.train.lightning_module.RslearnLightningModule
  init_args:
    model:
      class_path: rslearn.models.multitask.MultiTaskModel
      init_args:
        encoder:
        - class_path: rslearn.models.olmoearth_pretrain.model.OlmoEarth
          init_args:
            model_id: OLMOEARTH_V1_BASE
            patch_size: 5
            use_legacy_timestamps: false
            token_pooling: false
        decoders:
          segmentation:
          - class_path: rslearn.models.attention_pooling.AttentionPool
            init_args:
              in_dim: 768
              num_heads: 8
              linear_on_kv: true
          - class_path: rslearn.models.conv.Conv
            init_args:
              in_channels: 768
              out_channels: 2
              kernel_size: 2
              padding: valid
              stride: 2
              activation:
                class_path: torch.nn.Identity
          - class_path: rslearn.train.tasks.segmentation.SegmentationHead
            init_args:
              weights:
              - 0.05
              - 0.95
              dice_loss: true
              loss_weights:
              - 0.5
              - 1.5
              focal_loss: true
    optimizer:
      class_path: rslearn.train.optimizer.AdamW
      init_args:
        lr: 4.0e-05
        weight_decay: 0.01
    scheduler:
      class_path: rslearn.train.scheduler.CosineAnnealingScheduler
      init_args:
        T_max: 40
        eta_min: 1.0e-06
data:
  class_path: rslearn.train.data_module.RslearnDataModule
  init_args:
    path: /weka/dfive-default/rslearn-eai/datasets/wildfire/canada_fire_sat_full
    inputs:
      sentinel2_l2a:
        data_type: raster
        layers:
        - sentinel2
        bands:
        - B02
        - B03
        - B04
        - B08
        - B05
        - B06
        - B07
        - B8A
        - B11
        - B12
        - B01
        - B09
        passthrough: true
        dtype: FLOAT32
        load_all_item_groups: true
        load_all_layers: true
      label:
        data_type: raster
        layers:
        - label_100m
        bands:
        - label_100m
        dtype: INT32
        is_target: true
        resolution_factor:
          class_path: rslearn.utils.geometry.ResolutionFactor
          init_args:
            numerator: 1
            denominator: 1
    task:
      class_path: rslearn.train.tasks.multi_task.MultiTask
      init_args:
        tasks:
          segmentation:
            class_path: rslearn.train.tasks.segmentation.SegmentationTask
            init_args:
              num_classes: 2
              enable_miou_metric: true
              enable_f1_metric: true
              report_metric_per_class: true
              other_metrics:
                PRAUC_cls0:
                  class_path: rslearn.train.tasks.segmentation.SegmentationMetric
                  init_args:
                    metric:
                      class_path: torchmetrics.classification.MulticlassAveragePrecision
                      init_args:
                        num_classes: 2
                        average: null
                        thresholds: 128
                    class_idx: 0
                PRAUC_cls1:
                  class_path: rslearn.train.tasks.segmentation.SegmentationMetric
                  init_args:
                    metric:
                      class_path: torchmetrics.classification.MulticlassAveragePrecision
                      init_args:
                        num_classes: 2
                        average: null
                        thresholds: 128
                    class_idx: 1
        input_mapping:
          segmentation:
            label: targets
    batch_size: 16
    num_workers: 16
    default_config:
      crop_size: 50
      transforms:
      - class_path: rslearn.models.olmoearth_pretrain.norm.OlmoEarthNormalize
        init_args:
          band_names:
            sentinel2_l2a:
            - B02
            - B03
            - B04
            - B08
            - B05
            - B06
            - B07
            - B8A
            - B11
            - B12
            - B01
            - B09
      - class_path: rslearn.train.transforms.resize.Resize
        init_args:
          target_size:
          - 5
          - 5
          selectors:
          - target/segmentation/classes
          - target/segmentation/valid
    train_config:
      groups:
      - train
      transforms:
      - class_path: rslearn.train.transforms.flip.Flip
        init_args:
          horizontal: true
          vertical: true
          image_selectors:
          - sentinel2_l2a
          - target/segmentation/classes
          - target/segmentation/valid
      - class_path: rslearn.models.olmoearth_pretrain.norm.OlmoEarthNormalize
        init_args:
          band_names:
            sentinel2_l2a:
            - B02
            - B03
            - B04
            - B08
            - B05
            - B06
            - B07
            - B8A
            - B11
            - B12
            - B01
            - B09
      - class_path: rslearn.train.transforms.resize.Resize
        init_args:
          target_size:
          - 5
          - 5
          selectors:
          - target/segmentation/classes
          - target/segmentation/valid
    val_config:
      groups:
      - val
      center_crop: true
    test_config:
      groups:
      - test
      load_all_crops: true
    predict_config:
      load_all_crops: true
      overlap_pixels: 5
      skip_targets: true
trainer:
  max_epochs: 40
  callbacks:
  - class_path: lightning.pytorch.callbacks.progress.tqdm_progress.TQDMProgressBar
  - class_path: lightning.pytorch.callbacks.LearningRateMonitor
    init_args:
      logging_interval: epoch
  - class_path: lightning.pytorch.callbacks.ModelCheckpoint
    init_args:
      save_top_k: 1
      save_last: true
      monitor: val_segmentation/F1_segmentation/f1/cls_1
      mode: max
  - class_path: rslearn.train.callbacks.freeze_unfreeze.MultiStageFineTuning
    init_args:
      stages:
      - at_epoch: 0
        freeze_selectors:
        - model.encoder.0
        unfreeze_selectors: []
      - at_epoch: 15
        freeze_selectors: []
        unfreeze_selectors:
        - model.encoder.0
        scale_existing_groups: 0.0666667
        unfreeze_lr_factor: 1.0
rslp_project: 20260211_wf_burnrisk_nbac
rslp_experiment: s2_mts_atp_cs5_bs16_lr5e4_wd1e2_lw0515_focal
